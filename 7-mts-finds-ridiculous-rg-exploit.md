# MTS Finds Ridiculous RG Exploit

Presented by Adam Fraser-Kruck - Senior Embedded Developer PTx Trimble

## MTS - Technology Development

- 15 years ago worked for ISP creating automated tests for equipments
- One residential gateway (RG) from a manufacturer was really fun to test; it was ripe with issues
- Very surprising because this RG was already being distributed by Verizon
- Browsing the File System and saw a whole bunch of `.html` pages
- Unsecured Broadcom Sample Page (160+ pages)
- Not everyone thought this was a big deal; sent them a CSRF attack through email
- Sample code is often incomplete, doesn't consider security or error handling
- Few years earlier 2wire RGs & an ISP seriously affected 2 million users

## How to Apply Today

1. Scan for hidden sample management pages
2. Find exploits in other devices using same chipset
    - Find CPU chipset
    - Check for exploits in other devices

## State Machines & Security

- What is a state machine?
    - Hardware or software
    - Has states
    - Has transitions between states
    - Has actions
- Other names:
    - Finite State Machine (FSM)
    - State Chart
    - State Pattern
- Visual State Machines with StateSmith
    - Many IoT devices, a well known vacuum brand, safety critical application in France,...
- No FSM Trap
    - Evolve Code & Trust Events
        - Example: receive `on_upload_start()` and allocate buffer; what if receive multiple of said events
        - Hard to detect in large drivers
    - User Interfaces
        - When statefulness is needed, spaghetti variables are used
- Pentest Tips
    - Think workflows (password reset, authentication, ordering)
    - Visually map the workflow. Attack each point. Try various combinations
    - Look for repeated transitions for error handling. Often not fully tested by devs
- Hand coded state machines aren't perfect
- StateSmith helps create secure maintable code

## Q&A

- How to make sure the diagram is accurate?
    - Maybe biased but generate the diagram first.
    - If you already hand-coded state machine, there's no good options: can use AI tools but only work for very simple things
- Screenshot of the code generated by the diagram?
    - Yes, either use function pointers or switch statements
